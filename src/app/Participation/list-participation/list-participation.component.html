 
<div class="page-container">
  <h2 class="title">üìã S√©lection du Challenge</h2>

  <div class="form-container">
    <mat-form-field appearance="fill" class="form-field">
      <mat-label>Nom du challenge</mat-label>
      <input matInput [(ngModel)]="challengeName" name="challengeName" placeholder="ex: ch3" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="form-field">
      <mat-label>Type de participants √† afficher</mat-label>
      <mat-select [(ngModel)]="selectedType" name="selectedType">
        <mat-option value="agents">Agents</mat-option>
        <mat-option value="commercants">Commer√ßants</mat-option>
        <mat-option value="regions">Par R√©gion</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-raised-button color="primary" class="btn-afficher" (click)="onAfficher()">Afficher</button>
  </div>
</div>


<!-- Agents -->
<mat-card *ngIf="selectedType === 'agents'" class="mt-4">
  <h3>üë§ Agents Accept√©s</h3>

  <mat-table [dataSource]="agents" class="mat-elevation-z8">

    <!-- Code Agence -->
    <ng-container matColumnDef="codeAgence">
      <mat-header-cell *matHeaderCellDef>Code Agence</mat-header-cell>
      <mat-cell *matCellDef="let a">{{ a.codeAgence }}</mat-cell>
    </ng-container>

    <!-- Nom -->
    <ng-container matColumnDef="nom">
      <mat-header-cell *matHeaderCellDef>Nom</mat-header-cell>
      <mat-cell *matCellDef="let a">{{ a.nom }}</mat-cell>
    </ng-container>

    <!-- Email -->
    <ng-container matColumnDef="email">
      <mat-header-cell *matHeaderCellDef>Email</mat-header-cell>
      <mat-cell *matCellDef="let a">{{ a.email }}</mat-cell>
    </ng-container>

    <!-- R√©gion -->
    <ng-container matColumnDef="region">
      <mat-header-cell *matHeaderCellDef>R√©gion</mat-header-cell>
      <mat-cell *matCellDef="let a">{{ a.region }}</mat-cell>
    </ng-container>

    <!-- D√©finition des lignes -->
    <mat-header-row *matHeaderRowDef="['codeAgence', 'nom', 'email', 'region']"></mat-header-row>
    <mat-row *matRowDef="let row; columns: ['codeAgence', 'nom', 'email', 'region']"></mat-row>
  </mat-table>
</mat-card>


<!-- Commer√ßants -->
<mat-card *ngIf="selectedType === 'commercants'" class="mt-4">
  <h3>üßë‚Äçüíº Commer√ßants Accept√©s</h3>

  <mat-table [dataSource]="commercants" class="mat-elevation-z8">

    <!-- Code Agence -->
    <ng-container matColumnDef="codeAgence">
      <mat-header-cell *matHeaderCellDef>Code Agence</mat-header-cell>
      <mat-cell *matCellDef="let c">{{ c.codeAgence }}</mat-cell>
    </ng-container>

    <!-- Nom -->
    <ng-container matColumnDef="nom">
      <mat-header-cell *matHeaderCellDef>Nom</mat-header-cell>
      <mat-cell *matCellDef="let c">{{ c.nom }}</mat-cell>
    </ng-container>

    <!-- Email -->
    <ng-container matColumnDef="email">
      <mat-header-cell *matHeaderCellDef>Email</mat-header-cell>
      <mat-cell *matCellDef="let c">{{ c.email }}</mat-cell>
    </ng-container>

    <!-- R√©gion -->
    <ng-container matColumnDef="region">
      <mat-header-cell *matHeaderCellDef>R√©gion</mat-header-cell>
      <mat-cell *matCellDef="let c">{{ c.region }}</mat-cell>
    </ng-container>

    <!-- D√©finition des lignes -->
    <mat-header-row *matHeaderRowDef="['codeAgence', 'nom', 'email', 'region']"></mat-header-row>
    <mat-row *matRowDef="let row; columns: ['codeAgence', 'nom', 'email', 'region']"></mat-row>
  </mat-table>
</mat-card>


<!-- Par R√©gion -->
<mat-card *ngIf="selectedType === 'regions'" class="mt-4">
  <h5>üåç Participants Accept√©s Group√©s par R√©gion</h5>

  <div *ngFor="let region of participantsParRegion | keyvalue">
    <!-- üè∑Ô∏è Nom de la r√©gion + compte -->
  <h6 class="text-blue-700 font-bold mt-3">
  {{ region.key || 'Non d√©finie' }}
  (AGENTS: {{ countType(region.value, 'AGENT') }} |
   COMMERCANTS: {{ countType(region.value, 'COMMERCANT') }})
</h6>


    <table mat-table [dataSource]="region.value" class="mat-elevation-z4">

      <!-- Code Agence -->
      <ng-container matColumnDef="codeAgence">
        <th mat-header-cell *matHeaderCellDef>Code</th>
        <td mat-cell *matCellDef="let p">{{ p.codeAgence }}</td>
      </ng-container>

      <!-- Nom -->
      <ng-container matColumnDef="nom">
        <th mat-header-cell *matHeaderCellDef>Nom</th>
        <td mat-cell *matCellDef="let p">{{ p.nom }}</td>
      </ng-container>

      <!-- Type Agence -->
      <ng-container matColumnDef="typeAgence">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let p">{{ p.typeAgence }}</td>
      </ng-container>

      <!-- Email -->
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>Email</th>
        <td mat-cell *matCellDef="let p">{{ p.email }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr mat-row *matRowDef="let row; columns: columns;"></tr>
    </table>

    <mat-divider class="my-4"></mat-divider>
  </div>
</mat-card>
